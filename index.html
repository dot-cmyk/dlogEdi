<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive API Example</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <button id="login-btn">Google 로그인</button>
    <button id="check-file-btn" disabled>파일 확인 및 생성</button>

    <script>
        const CLIENT_ID = '474742043344-81ventkmf01jsh475eilq7f79r1io9ma.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyDbs-pBcsUBkLS-l3fKWnBG5a09ovCnXCM';
        // const CLIENT_ID = 'YOUR_CLIENT_ID_HERE'; // Google Cloud Console에서 발급받은 클라이언트 ID
        // const API_KEY = 'YOUR_API_KEY_HERE';     // Google Cloud Console에서 발급받은 API 키
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        const FILE_NAME = 'example.json'; // 확인할 파일 이름

        let gapiInited = false;
        let authInstance;

        // Google API 초기화
        function gapiInit() {
            gapi.load('client:auth2', async () => {
                await gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    scope: SCOPES,
                });
                authInstance = gapi.auth2.getAuthInstance();
                document.getElementById('login-btn').disabled = false;
            });
        }

        // 로그인 함수
        async function handleLogin() {
            try {
                await authInstance.signIn();
                document.getElementById('check-file-btn').disabled = false;
                alert('로그인 성공!');
            } catch (error) {
                console.error('로그인 실패:', error);
            }
        }

        // 파일 검색 및 생성 함수
        async function checkAndCreateFile() {
            try {
                const response = await gapi.client.drive.files.list({
                    q: `name='${FILE_NAME}' and trashed=false`,
                    fields: 'files(id, name)',
                });

                if (response.result.files.length > 0) {
                    alert(`파일이 이미 존재합니다: ${response.result.files[0].name}`);
                } else {
                    alert('파일이 없습니다. 새 파일을 생성합니다.');
                    await createFile();
                }
            } catch (error) {
                console.error('파일 확인 중 오류 발생:', error);
            }
        }

        // 새 JSON 파일 생성 함수
        async function createFile() {
            try {
                const metadata = {
                    name: FILE_NAME,
                    mimeType: 'application/json',
                };

                const fileContent = JSON.stringify({}); // 빈 JSON 내용
                const file = new Blob([fileContent], { type: 'application/json' });
                const formData = new FormData();
                formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                formData.append('file', file);

                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer ${gapi.auth.getToken().access_token}`,
                    },
                    body: formData,
                });

                if (response.ok) {
                    const fileData = await response.json();
                    alert(`파일 생성 완료: ${fileData.name}`);
                } else {
                    const errorData = await response.json();
                    console.error('파일 생성 실패:', errorData);
                }
            } catch (error) {
                console.error('파일 생성 중 오류 발생:', error);
            }
        }

        // 버튼 이벤트 연결
        document.getElementById('login-btn').addEventListener('click', handleLogin);
        document.getElementById('check-file-btn').addEventListener('click', checkAndCreateFile);

        // 초기화 호출
        gapiInit();
    </script>
</body>
</html>
